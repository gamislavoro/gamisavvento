<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>GAMis Avvento 2025</title>
  <meta name="theme-color" content="#b91c1c"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .card{box-shadow:0 2px 10px rgba(2,6,23,.06),0 16px 40px rgba(2,6,23,.08)}
    .chip{display:inline-flex;align-items:center;justify-content:center;padding:.38rem .62rem;border-radius:999px;border:1px solid #e5e7eb;background:#fff;font-weight:600;font-size:.85rem;cursor:pointer}
    .chip[aria-pressed="true"]{background:#b91c1c;color:#fff;border-color:#b91c1c}
    .swatch{width:26px;height:26px;border-radius:999px;border:2px solid #fff;box-shadow:0 0 0 1px #e5e7eb;cursor:pointer}
    .swatch[aria-selected="true"]{box-shadow:0 0 0 2px #b91c1c}
    .step{width:32px;height:32px;border-radius:10px;border:1px solid #e5e7eb;background:#fff;font-weight:700}
    .btn{display:inline-flex;align-items:center;justify-content:center;font-weight:700;border-radius:12px}
    .btn-primary{background:#b91c1c;color:#fff;padding:.75rem 1rem} .btn-primary:hover{background:#991b1b}
    .btn-ghost{background:#fff;border:1px solid #ef4444;color:#b91c1c;padding:.75rem 1rem} .btn-ghost:hover{background:#fee2e2}
  </style>
</head>
<body class="bg-slate-50 text-slate-800">

  <!-- HEADER -->
  <header class="bg-white/95 sticky top-0 z-40 backdrop-blur transition-transform duration-300 will-change-transform transform-gpu">
    <div class="max-w-6xl mx-auto px-4 md:px-6 py-3 md:py-4 flex items-center justify-center relative">
      <img id="logoTop" alt="Logo Seminario" class="h-14 md:h-16 w-auto cursor-pointer" src="https://raw.githubusercontent.com/gamislavoro/gamisavvento/main/images/logo.png"/>
      <span class="pointer-events-none absolute inset-x-0 bottom-0 h-px bg-slate-200"></span>
    </div>
  </header>

  <!-- HERO -->
  <section class="relative">
    <div class="w-full bg-cover bg-center min-h-[360px] md:min-h-[520px]"
         style="background-image:url('https://raw.githubusercontent.com/gamislavoro/gamisavvento/main/images/hero.jpg')"></div>
    <div class="absolute inset-0 bg-black/40"></div>
    <div class="absolute inset-0 flex items-center justify-center">
      <div class="text-center text-white px-4">
        <h1 class="text-3xl md:text-5xl font-extrabold leading-tight">A Natale dona speranza</h1>
        <p class="mt-3 text-lg text-white/90">Scegli i prodotti e ci aiuti a pianificare la raccolta fondi.</p>
        <div class="mt-5 flex gap-2 justify-center">
          <a href="#prodotti" class="btn btn-primary">Scegli i prodotti</a>
          <a href="#preordina" class="btn btn-ghost">Preordina</a>
        </div>
      </div>
    </div>
  </section>

  <main class="max-w-6xl mx-auto px-4 md:px-6">
    <div class="py-8 flex items-center justify-between border-b border-slate-200 mb-6">
      <h2 id="prodotti" class="text-2xl font-bold">Prodotti</h2>
      <div id="totaleTop" class="text-xl font-semibold text-slate-700">Totale stimato: € 0,00</div>
    </div>

    <!-- PRODOTTI -->
    <section class="py-4">
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">

        <!-- BIRRA -->
        <article id="card-birra" class="bg-white rounded-2xl card overflow-hidden p-4" data-kind="birra">
          <img class="w-full aspect-square object-cover rounded-xl mb-4" alt="Birra"
               src="https://raw.githubusercontent.com/gamislavoro/gamisavvento/main/images/birra.jpg"/>
          <h3 class="font-semibold mb-2">Birra</h3>
          <div class="text-xs text-slate-500 mb-2">Formato</div>
          <div class="flex flex-wrap gap-2 mb-4" data-chip-group="formato">
            <button type="button" class="chip" aria-pressed="true" data-value="Cassa da 6">Cassa da 6</button>
          </div>
          <div class="flex items-center justify-between mb-3">
            <span class="text-sm">Variante corrente</span>
            <div class="inline-flex items-center gap-2">
              <button type="button" class="step" data-draft-stepper data-delta="-1">–</button>
              <span class="min-w-[1.5ch] text-center" data-draft-qty>0</span>
              <button type="button" class="step" data-draft-stepper data-delta="1">+</button>
            </div>
          </div>
          <button type="button" class="btn btn-ghost w-full mb-3" data-add-variant>+ Aggiungi variante</button>
          <div class="space-y-2" data-list></div>
        </article>

        <!-- FELPA -->
        <article id="card-felpa" class="bg-white rounded-2xl card overflow-hidden p-4" data-kind="felpa">
          <img class="w-full aspect-square object-cover rounded-xl mb-4" alt="Felpa"
               src="https://raw.githubusercontent.com/gamislavoro/gamisavvento/main/images/felpa.jpg"/>
          <h3 class="font-semibold mb-2">Felpa</h3>

          <div class="text-xs text-slate-500 mb-2">Modello</div>
          <div class="flex items-center gap-2 mb-4" data-swatch-group="modello">
            <button type="button" class="swatch ring-1 ring-slate-300" style="background:#ffffff" data-value="Bianco" aria-selected="true" title="Bianco"></button>
            <button type="button" class="swatch" style="background:#111827" data-value="Nero" aria-selected="false" title="Nero"></button>
          </div>

          <div class="text-xs text-slate-500 mb-2">Stampa</div>
          <div class="flex items-center gap-2 mb-4" data-swatch-group="stampa">
            <button type="button" class="swatch" style="background:#111827" data-value="Nero" aria-selected="true"  title="Nero"></button>
            <button type="button" class="swatch" style="background:#cbd5e1" data-value="Grigio" title="Grigio"></button>
            <button type="button" class="swatch" style="background:#7f1d1d" data-value="Bordeaux" title="Bordeaux"></button>
            <button type="button" class="swatch" style="background:#14532d" data-value="Verde bosco" title="Verde bosco"></button>
            <button type="button" class="swatch" style="background:#1e3a8a" data-value="Blu navy" title="Blu navy"></button>
          </div>

          <div class="text-xs text-slate-500 mb-2">Taglia</div>
          <div class="flex flex-wrap gap-2 mb-4" data-chip-group="taglia">
            <button type="button" class="chip" aria-pressed="true" data-value="S">S</button>
            <button type="button" class="chip" data-value="M">M</button>
            <button type="button" class="chip" data-value="L">L</button>
            <button type="button" class="chip" data-value="XL">XL</button>
            <button type="button" class="chip" data-value="XXL">XXL</button>
          </div>

          <div class="flex items-center justify-between mb-3">
            <span class="text-sm">Variante corrente</span>
            <div class="inline-flex items-center gap-2">
              <button type="button" class="step" data-draft-stepper data-delta="-1">–</button>
              <span class="min-w-[1.5ch] text-center" data-draft-qty>0</span>
              <button type="button" class="step" data-draft-stepper data-delta="1">+</button>
            </div>
          </div>
          <button type="button" class="btn btn-ghost w-full mb-3" data-add-variant>+ Aggiungi variante</button>
          <div class="space-y-2" data-list></div>
        </article>

        <!-- CAPPELLO -->
        <article id="card-cappello" class="bg-white rounded-2xl card overflow-hidden p-4" data-kind="cappello">
          <img class="w-full aspect-square object-cover rounded-xl mb-4" alt="Cappello"
               src="https://raw.githubusercontent.com/gamislavoro/gamisavvento/main/images/cappello.jpg"/>
          <h3 class="font-semibold mb-2">Cappello</h3>
          <div class="text-xs text-slate-500 mb-2">Colore</div>
          <div class="flex items-center gap-2 mb-4" data-swatch-group="colore">
            <button type="button" class="swatch" style="background:#111827" data-value="Nero" aria-selected="true" title="Nero"></button>
            <button type="button" class="swatch" style="background:#cbd5e1" data-value="Grigio" title="Grigio"></button>
            <button type="button" class="swatch" style="background:#ef4444" data-value="Rosso" title="Rosso"></button>
            <button type="button" class="swatch" style="background:#16a34a" data-value="Verde" title="Verde"></button>
            <button type="button" class="swatch" style="background:#1d4ed8" data-value="Blu" title="Blu"></button>
          </div>
          <div class="flex items-center justify-between mb-3">
            <span class="text-sm">Variante corrente</span>
            <div class="inline-flex items-center gap-2">
              <button type="button" class="step" data-draft-stepper data-delta="-1">–</button>
              <span class="min-w-[1.5ch] text-center" data-draft-qty>0</span>
              <button type="button" class="step" data-draft-stepper data-delta="1">+</button>
            </div>
          </div>
          <button type="button" class="btn btn-ghost w-full mb-3" data-add-variant>+ Aggiungi variante</button>
          <div class="space-y-2" data-list></div>
        </article>

        <!-- DOLCI -->
        <article id="card-dolce" class="bg-white rounded-2xl card overflow-hidden p-4" data-kind="dolce">
          <img class="w-full aspect-square object-cover rounded-xl mb-4" alt="Dolci"
               src="https://raw.githubusercontent.com/gamislavoro/gamisavvento/main/images/dolci.jpg"/>
          <h3 class="font-semibold mb-2">Dolci</h3>
          <div class="text-xs text-slate-500 mb-2">Tipo</div>
          <div class="flex flex-wrap gap-2 mb-4" data-chip-group="tipo">
            <button type="button" class="chip" aria-pressed="true" data-value="Pandoro classico">Pandoro classico</button>
            <button type="button" class="chip" data-value="Pandoro al cioccolato">Pandoro al cioccolato</button>
            <button type="button" class="chip" data-value="Panettone">Panettone</button>
          </div>
          <div class="flex items-center justify-between mb-3">
            <span class="text-sm">Variante corrente</span>
            <div class="inline-flex items-center gap-2">
              <button type="button" class="step" data-draft-stepper data-delta="-1">–</button>
              <span class="min-w-[1.5ch] text-center" data-draft-qty>0</span>
              <button type="button" class="step" data-draft-stepper data-delta="1">+</button>
            </div>
          </div>
          <button type="button" class="btn btn-ghost w-full mb-3" data-add-variant>+ Aggiungi variante</button>
          <div class="space-y-2" data-list></div>
        </article>

      </div>
    </section>

    <!-- PREORDINA -->
    <section id="preordina" class="py-10">
      <div class="grid md:grid-cols-3 gap-6">
        <div class="md:col-span-2 bg-white rounded-2xl card p-5">
          <h2 class="text-xl font-bold">I tuoi dati</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
            <div>
              <label class="text-xs text-slate-600">Nome</label>
              <input id="nome" class="mt-1 w-full rounded-xl border border-slate-200 px-3 py-3" placeholder="Es. Maria"/>
            </div>
            <div>
              <label class="text-xs text-slate-600">Cognome</label>
              <input id="cognome" class="mt-1 w-full rounded-xl border border-slate-200 px-3 py-3" placeholder="Es. Rossi"/>
            </div>
            <div class="md:col-span-2">
              <label class="text-xs text-slate-600">Cellulare</label>
              <input id="cellulare" class="mt-1 w-full rounded-xl border border-slate-200 px-3 py-3" placeholder="Es. 3331234567"/>
            </div>
            <div class="md:col-span-2">
              <label class="text-xs text-slate-600">Seminarista di riferimento</label>
              <select id="seminarista" class="mt-1 w-full rounded-xl border border-slate-200 px-3 py-3"></select>
            </div>
          </div>
          <div class="mt-4 flex items-start gap-3">
            <input type="checkbox" id="consenso" class="mt-1 h-4 w-4"/>
            <label for="consenso" class="text-sm">Acconsento al trattamento dei dati per finalità organizzative della raccolta (GDPR).</label>
          </div>
          <div class="mt-5 flex items-center justify-between gap-3">
            <div class="text-xs text-slate-500">Stato: <span id="status">in attesa</span></div>
            <button id="submitBtn" class="btn btn-primary">Invia preordine</button>
          </div>
          <div id="result" class="text-sm mt-3 text-slate-700"></div>
        </div>

        <aside class="bg-white rounded-2xl card p-5">
          <h3 class="font-semibold">Riepilogo</h3>
          <div class="mt-2 text-sm text-slate-600 space-y-1">
            <div class="flex justify-between"><span>Birra</span><span id="sum-birra">0</span></div>
            <div class="flex justify-between"><span>Felpa</span><span id="sum-felpa">0</span></div>
            <div class="flex justify-between"><span>Cappello</span><span id="sum-cappello">0</span></div>
            <div class="flex justify-between"><span>Dolce</span><span id="sum-dolce">0</span></div>
            <hr class="my-2 border-slate-200"/>
            <div class="flex justify-between font-semibold"><span>Totale stimato</span><span id="totaleSide">€ 0,00</span></div>
          </div>
          <p class="mt-3 text-xs text-slate-500">È una stima: l’ordine verrà confermato con il tuo seminarista.</p>
        </aside>
      </div>
    </section>
  </main>

  <footer class="mt-10 bg-slate-900 text-slate-100">
    <div class="max-w-6xl mx-auto px-4 md:px-6 py-8 text-center">
      <img alt="Logo Seminario" class="h-8 w-auto mx-auto opacity-95" src="https://raw.githubusercontent.com/gamislavoro/gamisavvento/main/images/logo.png"/>
      <div class="text-xs opacity-80 mt-2">© <span id="yearNow"></span> GAMis - Seminario Arcivescovile di Milano</div>
    </div>
  </footer>

<script>
/* ====== CONFIG ====== */
const ENDPOINT = "PASTE_QUI_IL_TUO_URL_EXEC"; // <-- METTI QUI il tuo URL /exec della Web App

const SEMINARISTI = ["— Seleziona —","Abbate don Nikolas","Angelini don Andrea","Bassi Andrea","Bergamini don Gioele","Bianchi don Giuseppe","Bisi Federico","Bolaños Josè","Brancè don Samuele","Caholo Gilberto","Capizzi Emanuele","Carchedi Davide","Cardani Lorenzo","Combi Fabio","Conti Giacomo","Corti Giovanni","Crivellari Matteo","Erroi Filippo","Ferrera Pietro","Frattolillo don Nicolò","Freddi Giacomo","Garzone Alessandro","Gazzoli Daniele","Giovenzana Francesco","Girelli Simone","Gorno Riccardo","Guido don Emanuele","Landini Marco","Lattuada Stefano","Maccà don Paolo","Macchi don Paolo","Magistrelli don Stefano","Marchiori Manuel","Mariani Massimiliano","Martinelli Samuele","Mbala Simon","Meda Francesco","Mesiano Lorenzo","Molteni don Lorenzo","Nossa Alessandro","Orfano Michele","Pagani Carlo","Palazzo Andrea","Pandolfi Andrea","Parini Giovanni","Pasquot Filippo","Perego Gianluca","Rossi Alessandro","Santambrogio Tommaso","Sinigaglia Francesco","Swich don Andrea","Tamburrino Stefano","Tchingui Moises","Valli Giovanni","Vicini Alessio","Zannini Alessandro","Zappaterra Matteo","Altro…"];

const OPTIONS = {
  birra:   { price: 10, chipGroups: { formato: ["Cassa da 6"] }, swatchGroups: {} },
  felpa:   { price: 25, chipGroups: { taglia: ["S","M","L","XL","XXL"] },
             swatchGroups: {
               modello: [{label:"Bianco",hex:"#ffffff"}, {label:"Nero",hex:"#111827"}],
               stampa:  [{label:"Nero",hex:"#111827"}, {label:"Grigio",hex:"#cbd5e1"}, {label:"Bordeaux",hex:"#7f1d1d"}, {label:"Verde bosco",hex:"#14532d"}, {label:"Blu navy",hex:"#1e3a8a"}]
             } },
  cappello:{ price: 12, chipGroups: {}, swatchGroups: { colore: [
               {label:"Nero",hex:"#111827"},{label:"Grigio",hex:"#cbd5e1"},{label:"Rosso",hex:"#ef4444"},{label:"Verde",hex:"#16a34a"},{label:"Blu",hex:"#1d4ed8"} ] } },
  dolce:   { price: 10, chipGroups: { tipo: ["Pandoro classico","Pandoro al cioccolato","Panettone"] }, swatchGroups: {} }
};

/* ====== STATO ====== */
const state = {
  birra:[], felpa:[], cappello:[], dolce:[],
  draft:{
    birra:{formato:'Cassa da 6', qty:0},
    felpa:{modello:'Bianco', stampa:'Nero', taglia:'S', qty:0},
    cappello:{colore:'Nero', qty:0},
    dolce:{tipo:'Pandoro classico', qty:0}
  }
};

/* ====== UTILS ====== */
const eur = n=>(Number.isFinite(n)?n:0).toLocaleString('it-IT',{style:'currency',currency:'EUR'});
const qtySum = arr=> Array.isArray(arr)? arr.reduce((a,i)=> a + (parseFloat(i.qty)||0), 0) : 0;
const qtyAll = k => qtySum(state[k]) + (parseFloat(state.draft[k]?.qty)||0);
const price = k => parseFloat(OPTIONS[k]?.price)||0;
const total = () => ['birra','felpa','cappello','dolce'].reduce((s,k)=> s + qtyAll(k)*price(k), 0);

function refresh(){
  const t = total();
  const t1=document.getElementById('totaleTop'); if(t1) t1.textContent='Totale stimato: '+eur(t);
  const t2=document.getElementById('totaleSide'); if(t2) t2.textContent='Totale stimato: '+eur(t);
  const setLine=(id,kind)=>{
    const q = qtyAll(kind);
    const varianti = state[kind].length + ((parseFloat(state.draft[kind]?.qty)||0) > 0 ? 1 : 0);
    const el=document.getElementById(id); if(el) el.textContent = `${q} pz / ${varianti} varianti`;
  };
  setLine('sum-birra','birra'); setLine('sum-felpa','felpa'); setLine('sum-cappello','cappello'); setLine('sum-dolce','dolce');
}

function renderList(root, kind){
  const box = root.querySelector('[data-list]');
  const items = state[kind];
  box.innerHTML = items.map((it,idx)=>{
    const label = kind==='birra' ? `${it.qty} × ${it.formato}`
      : kind==='felpa' ? `${it.qty} × Felpa, modello ${it.modello} stampa ${it.stampa} ${it.taglia}`
      : kind==='cappello' ? `${it.qty} × Cappello, ${it.colore}`
      : `${it.qty} × ${it.tipo}`;
    return `<div class="flex items-center justify-between rounded-xl border border-slate-200 px-3 py-2" data-idx="${idx}">
      <span class="text-sm">${label}</span>
      <span class="inline-flex items-center gap-2">
        <button type="button" class="step" data-row-step="-1">–</button>
        <button type="button" class="step" data-row-step="1">+</button>
        <button type="button" class="px-2 py-1 rounded-lg border border-slate-200" data-row-remove>Rimuovi</button>
      </span>
    </div>`;
  }).join('');
}

function bindCard(kind){
  const root = document.getElementById(`card-${kind}`);
  const d = state.draft[kind];

  // chips
  root.querySelectorAll('[data-chip-group]').forEach(group=>{
    group.addEventListener('click', (e)=>{
      const btn = e.target.closest('.chip'); if(!btn) return;
      group.querySelectorAll('.chip').forEach(c=>c.setAttribute('aria-pressed','false'));
      btn.setAttribute('aria-pressed','true');
      d[group.getAttribute('data-chip-group')] = btn.getAttribute('data-value');
      refresh();
    });
  });

  // swatches
  root.querySelectorAll('[data-swatch-group]').forEach(group=>{
    group.addEventListener('click', (e)=>{
      const sw = e.target.closest('.swatch'); if(!sw) return;
      group.querySelectorAll('.swatch').forEach(s=>s.setAttribute('aria-selected','false'));
      sw.setAttribute('aria-selected','true');
      d[group.getAttribute('data-swatch-group')] = sw.getAttribute('data-value');
      refresh();
    });
  });

  // draft stepper
  root.querySelectorAll('[data-draft-stepper]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const delta = parseInt(btn.getAttribute('data-delta'),10);
      d.qty = Math.max(0,(parseFloat(d.qty)||0)+delta);
      const qEl = root.querySelector('[data-draft-qty]'); if(qEl) qEl.textContent = d.qty;
      refresh();
    });
  });

  // add variant
  const addBtn = root.querySelector('[data-add-variant]');
  if(addBtn){
    addBtn.addEventListener('click', ()=>{
      if(!d.qty || d.qty<=0){ refresh(); return; }
      const list = state[kind];
      const same = list.find(it=> Object.keys(d).every(k=> k==='qty' ? true : it[k]===d[k]));
      if (same) {
        same.qty += d.qty;
      } else {
        // per felpa salvo SOLO nuove chiavi
        if (kind === 'felpa') {
          list.push({ modello: d.modello, stampa: d.stampa, taglia: d.taglia, qty: Number(d.qty)||0 });
        } else {
          list.push({ ...d });
        }
      }
      d.qty = 0; const qEl = root.querySelector('[data-draft-qty]'); if(qEl) qEl.textContent = '0';
      renderList(root, kind); refresh();
    });
  }

  // list handlers
  const listEl = root.querySelector('[data-list]');
  if(listEl){
    listEl.addEventListener('click', (e)=>{
      const line = e.target.closest('[data-idx]'); if(!line) return;
      const idx = +line.getAttribute('data-idx');
      if(e.target.closest('[data-row-step]')){
        const delta = +e.target.closest('[data-row-step]').getAttribute('data-row-step');
        state[kind][idx].qty = Math.max(0,(parseFloat(state[kind][idx].qty)||0)+delta);
        if(state[kind][idx].qty===0) state[kind].splice(idx,1);
        renderList(root, kind); refresh();
      }
      if(e.target.closest('[data-row-remove]')){
        state[kind].splice(idx,1); renderList(root, kind); refresh();
      }
    });
  }
}

/* ====== INIT ====== */
['birra','felpa','cappello','dolce'].forEach(k=>{ bindCard(k); renderList(document.getElementById(`card-${k}`),k); });
(function(){ const sel = document.getElementById('seminarista'); if(!sel) return; SEMINARISTI.forEach(n=>{ const o=document.createElement('option'); o.value=n; o.textContent=n; sel.appendChild(o); }); })();
(function(){ const y = document.getElementById('yearNow'); if(y) y.textContent = new Date().getFullYear(); })();
refresh();

/* ====== INVIO A GOOGLE SHEET (una riga per variante) ====== */
document.getElementById('submitBtn').addEventListener('click', async ()=>{
  const nome = document.getElementById('nome').value.trim();
  const cognome = document.getElementById('cognome').value.trim();
  const cell = document.getElementById('cellulare').value.trim();
  const semSel = document.getElementById('seminarista').value;
  const seminarista = (!semSel || semSel==='— Seleziona —') ? '' : semSel;

  const status = document.getElementById('status');
  const result = document.getElementById('result');

  const pezzi = qtyAll('birra')+qtyAll('felpa')+qtyAll('cappello')+qtyAll('dolce');
  const err = !nome||!cognome ? 'Compila Nome e Cognome.' :
              !/^[+]?\d{7,15}$/.test(cell.replace(/\s+/g,'')) ? 'Inserisci un numero valido (7–15 cifre).' :
              pezzi===0 ? 'Indica almeno un prodotto (quantità > 0).' : null;
  if(err){ status.textContent='errore'; result.textContent=err; return; }

  status.textContent='invio…'; result.textContent='Invio in corso…';

  const ts   = new Date().toISOString();
  const base = [ts, nome, cognome, cell, seminarista];
  const tot  = total();

  const rows = [];
  state.birra.forEach(b   => { const q=+b.qty||0; if(q) rows.push([...base,'Birra','',          '',            '',      q, tot]); });
  state.felpa.forEach(f   => { const q=+f.qty||0; if(q) rows.push([...base,'Felpa',f.modello||'',f.stampa||'', f.taglia||'', q, tot]); });
  state.cappello.forEach(c=> { const q=+c.qty||0; if(q) rows.push([...base,'Cappello','',       c.colore||'',  '',      q, tot]); });
  state.dolce.forEach(d   => { const q=+d.qty||0; if(q) rows.push([...base,'Dolce','',          d.tipo||'',    '',      q, tot]); });

  const payload = { rows };

  try{
    const res = await fetch(ENDPOINT, { method:'POST', headers:{'Content-Type':'text/plain'}, body: JSON.stringify(payload) });
    const data = await res.json();
    if(data.status==='ok'){
      status.textContent='inviato'; result.textContent='Grazie! Preordine registrato.';
      ['birra','felpa','cappello','dolce'].forEach(k=>{
        state[k]=[]; state.draft[k].qty=0;
        renderList(document.getElementById(`card-${k}`),k);
        const el=document.querySelector(`#card-${k} [data-draft-qty]`); if(el) el.textContent='0';
      });
      refresh();
    } else {
      throw new Error(data.message || 'Errore generico');
    }
  }catch(e){
    status.textContent='errore';
    result.textContent='Invio fallito. ' + (e?.message||'Errore di rete/CORS');
  }
});

/* UX minime */
document.getElementById('logoTop').addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
</script>
</body>
</html>
