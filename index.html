<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>GAMis Avvento 2025</title>
  <meta name="theme-color" content="#b91c1c"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* SAFE MODE & layout */
    .card{box-shadow:0 2px 10px rgba(2,6,23,.06),0 16px 40px rgba(2,6,23,.08)}
    .chip{display:inline-flex;align-items:center;justify-content:center;padding:.38rem .62rem;border-radius:999px;border:1px solid #e5e7eb;background:#fff;font-weight:600;font-size:.85rem;cursor:pointer}
    .chip[aria-pressed="true"]{background:#b91c1c;color:#fff;border-color:#b91c1c}
    .swatch{width:26px;height:26px;border-radius:999px;border:2px solid #fff;box-shadow:0 0 0 1px #e5e7eb;cursor:pointer}
    .swatch[aria-selected="true"]{box-shadow:0 0 0 2px #b91c1c}
    .step{width:32px;height:32px;border-radius:10px;border:1px solid #e5e7eb;background:#fff;font-weight:700}
    .btn{display:inline-flex;align-items:center;justify-content:center;font-weight:700;border-radius:12px}
    .btn-primary{background:#b91c1c;color:#fff;padding:.75rem 1rem} .btn-primary:hover{background:#991b1b}
    .btn-ghost{background:#fff;border:1px solid #ef4444;color:#b91c1c;padding:.75rem 1rem} .btn-ghost:hover{background:#fee2e2}

    /* livelli sicuri: niente overlay che blocca i click */
    main, #prodotti, #preordina, article.card { position: relative; z-index: 10; }

    /* banner errori JS */
    #jsError{position:fixed;left:0;right:0;top:0;z-index:50;display:none}
  </style>
</head>
<body class="bg-slate-50 text-slate-800">

  <!-- HEADER con logo centrato -->
  <header class="bg-white/90 backdrop-blur sticky top-0 z-40 border-b border-slate-200">
    <div class="max-w-6xl mx-auto px-4 md:px-6 h-14 flex items-center justify-center">
      <img id="logoTop" alt="Logo Seminario" class="h-8 w-auto"/>
    </div>
  </header>

  <!-- JS error banner -->
  <div id="jsError" class="mx-auto max-w-6xl px-4 md:px-6 py-2">
    <div class="bg-red-600 text-white rounded-lg px-4 py-2 shadow">Errore Javascript: <span id="jsErrorMsg"></span></div>
  </div>

  <!-- HERO SAFE MODE: nessun overlay assoluto che copre -->
  <section class="relative">
    <div id="heroBgSafe" class="w-full bg-cover bg-center min-h-[220px] md:min-h-[340px]"></div>
    <div class="max-w-6xl mx-auto px-4 md:px-6 py-8">
      <div class="max-w-xl">
        <h1 class="text-3xl md:text-5xl font-extrabold leading-tight">A Natale dona speranza</h1>
        <p class="mt-3 text-lg text-slate-700">
          Scegli i prodotti e ci aiuti a pianificare la raccolta fondi per la Terra Santa. Ti ricontatteremo per la conferma.
        </p>
        <div class="mt-5 flex gap-2">
          <a href="#prodotti" class="btn btn-primary">Scegli i prodotti</a>
          <a href="#causa" class="btn btn-ghost">Scopri la causa</a>
        </div>
      </div>
    </div>
  </section>

  <main class="max-w-6xl mx-auto px-4 md:px-6">
    <!-- Titolo + Totale -->
    <div class="py-8 flex items-center justify-between border-b border-slate-200 mb-6">
      <h2 class="text-2xl font-bold">Prodotti</h2>
      <div id="totaleTop" class="text-xl font-semibold text-slate-700">Totale stimato: € 0,00</div>
    </div>

    <!-- PRODOTTI -->
    <section id="prodotti" class="py-4">
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">

        <!-- BIRRA -->
        <article id="card-birra" class="bg-white rounded-2xl card overflow-hidden" data-kind="birra">
          <img id="img-birra" class="h-40 w-full object-cover" alt="Birra"/>
          <div class="p-4 space-y-4">
            <header class="flex items-center justify-between">
              <h3 class="font-semibold">Birra</h3>
              <span class="text-xs px-2 py-1 rounded-full bg-sky-100 text-sky-700 border border-sky-200">artigianale</span>
            </header>
            <p class="text-sm text-slate-600">Birra artigianale selezionata, disponibile in confezione da 6 bottiglie, ideale per brindare insieme.</p>
            <div>
              <div class="text-xs text-slate-500 mb-2">Formato</div>
              <div class="flex flex-wrap gap-2" data-chip-group="formato">
                <button type="button" class="chip" aria-pressed="true" data-value="Cassa da 6">Cassa da 6</button>
              </div>
            </div>
            <div class="flex items-center justify-between">
              <span class="text-sm">Variante corrente</span>
              <div class="inline-flex items-center gap-2">
                <button type="button" class="step" data-draft-stepper data-delta="-1">–</button>
                <span class="min-w-[1.5ch] text-center" data-draft-qty>0</span>
                <button type="button" class="step" data-draft-stepper data-delta="1">+</button>
              </div>
            </div>
            <button type="button" class="btn btn-ghost w-full" data-add-variant>+ Aggiungi variante</button>
            <div class="space-y-2" data-list></div>
          </div>
        </article>

        <!-- FELPA -->
        <article id="card-felpa" class="bg-white rounded-2xl card overflow-hidden" data-kind="felpa">
          <img id="img-felpa" class="h-40 w-full object-cover" alt="Felpa"/>
          <div class="p-4 space-y-4">
            <header class="flex items-center justify-between">
              <h3 class="font-semibold">Felpa</h3>
              <span class="text-xs px-2 py-1 rounded-full bg-emerald-100 text-emerald-700 border border-emerald-200">invernale</span>
            </header>
            <p class="text-sm text-slate-600">Felpa comoda e calda, perfetta per l’inverno, disponibile in vari colori e taglie.</p>
            <div>
              <div class="text-xs text-slate-500 mb-2">Colore</div>
              <div class="flex items-center gap-2" data-swatch-group="colore">
                <button type="button" class="swatch" style="background:#111827" data-value="Nero" aria-selected="true" title="Nero"></button>
                <button type="button" class="swatch" style="background:#cbd5e1" data-value="Grigio" aria-selected="false" title="Grigio"></button>
                <button type="button" class="swatch" style="background:#7f1d1d" data-value="Bordeaux" aria-selected="false" title="Bordeaux"></button>
                <button type="button" class="swatch" style="background:#14532d" data-value="Verde bosco" aria-selected="false" title="Verde bosco"></button>
                <button type="button" class="swatch" style="background:#1e3a8a" data-value="Blu navy" aria-selected="false" title="Blu navy"></button>
              </div>
            </div>
            <div>
              <div class="text-xs text-slate-500 mb-2">Taglia</div>
              <div class="flex flex-wrap gap-2" data-chip-group="taglia">
                <button type="button" class="chip" aria-pressed="true" data-value="S">S</button>
                <button type="button" class="chip" aria-pressed="false" data-value="M">M</button>
                <button type="button" class="chip" aria-pressed="false" data-value="L">L</button>
                <button type="button" class="chip" aria-pressed="false" data-value="XL">XL</button>
                <button type="button" class="chip" aria-pressed="false" data-value="XXL">XXL</button>
              </div>
            </div>
            <div class="flex items-center justify-between">
              <span class="text-sm">Variante corrente</span>
              <div class="inline-flex items-center gap-2">
                <button type="button" class="step" data-draft-stepper data-delta="-1">–</button>
                <span class="min-w-[1.5ch] text-center" data-draft-qty>0</span>
                <button type="button" class="step" data-draft-stepper data-delta="1">+</button>
              </div>
            </div>
            <button type="button" class="btn btn-ghost w-full" data-add-variant>+ Aggiungi variante</button>
            <div class="space-y-2" data-list></div>
          </div>
        </article>

        <!-- CAPPELLO -->
        <article id="card-cappello" class="bg-white rounded-2xl card overflow-hidden" data-kind="cappello">
          <img id="img-cappello" class="h-40 w-full object-cover" alt="Cappello"/>
          <div class="p-4 space-y-4">
            <header class="flex items-center justify-between">
              <h3 class="font-semibold">Cappello</h3>
              <span class="text-xs px-2 py-1 rounded-full bg-indigo-100 text-indigo-700 border border-indigo-200">lana</span>
            </header>
            <p class="text-sm text-slate-600">Cappello giovane e pratico, per affrontare il freddo con stile.</p>
            <div>
              <div class="text-xs text-slate-500 mb-2">Colore</div>
              <div class="flex items-center gap-2" data-swatch-group="colore">
                <button type="button" class="swatch" style="background:#111827" data-value="Nero" aria-selected="true" title="Nero"></button>
                <button type="button" class="swatch" style="background:#cbd5e1" data-value="Grigio" aria-selected="false" title="Grigio"></button>
                <button type="button" class="swatch" style="background:#ef4444" data-value="Rosso" aria-selected="false" title="Rosso"></button>
                <button type="button" class="swatch" style="background:#16a34a" data-value="Verde" aria-selected="false" title="Verde"></button>
                <button type="button" class="swatch" style="background:#1d4ed8" data-value="Blu" aria-selected="false" title="Blu"></button>
              </div>
            </div>
            <div class="flex items-center justify-between">
              <span class="text-sm">Variante corrente</span>
              <div class="inline-flex items-center gap-2">
                <button type="button" class="step" data-draft-stepper data-delta="-1">–</button>
                <span class="min-w-[1.5ch] text-center" data-draft-qty>0</span>
                <button type="button" class="step" data-draft-stepper data-delta="1">+</button>
              </div>
            </div>
            <button type="button" class="btn btn-ghost w-full" data-add-variant>+ Aggiungi variante</button>
            <div class="space-y-2" data-list></div>
          </div>
        </article>

        <!-- DOLCI -->
        <article id="card-dolce" class="bg-white rounded-2xl card overflow-hidden" data-kind="dolce">
          <img id="img-dolce" class="h-40 w-full object-cover" alt="Dolci"/>
          <div class="p-4 space-y-4">
            <header class="flex items-center justify-between">
              <h3 class="font-semibold">Dolci</h3>
              <span class="text-xs px-2 py-1 rounded-full bg-amber-100 text-amber-800 border border-amber-200">tradizione</span>
            </header>
            <p class="text-sm text-slate-600">Dolci della tradizione natalizia, per condividere il sapore autentico delle feste.</p>
            <div>
              <div class="text-xs text-slate-500 mb-2">Tipo</div>
              <div class="flex flex-wrap gap-2" data-chip-group="tipo">
                <button type="button" class="chip" aria-pressed="true" data-value="Pandoro classico">Pandoro classico</button>
                <button type="button" class="chip" aria-pressed="false" data-value="Pandoro al cioccolato">Pandoro al cioccolato</button>
                <button type="button" class="chip" aria-pressed="false" data-value="Panettone">Panettone</button>
              </div>
            </div>
            <div class="flex items-center justify-between">
              <span class="text-sm">Variante corrente</span>
              <div class="inline-flex items-center gap-2">
                <button type="button" class="step" data-draft-stepper data-delta="-1">–</button>
                <span class="min-w-[1.5ch] text-center" data-draft-qty>0</span>
                <button type="button" class="step" data-draft-stepper data-delta="1">+</button>
              </div>
            </div>
            <button type="button" class="btn btn-ghost w-full" data-add-variant>+ Aggiungi variante</button>
            <div class="space-y-2" data-list></div>
          </div>
        </article>

      </div>
    </section>

    <!-- PREORDINA + RIEPILOGO -->
    <section id="preordina" class="py-10">
      <div class="grid md:grid-cols-3 gap-6">
        <div class="md:col-span-2 bg-white rounded-2xl card p-5">
          <h2 class="text-xl font-bold">I tuoi dati</h2>
          <p class="text-sm text-slate-600 mb-4">Ti ricontatteremo per conferma prima dell'ordine vero.</p>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
            <div>
              <label class="text-xs text-slate-600">Nome</label>
              <input id="nome" class="mt-1 w-full rounded-xl border border-slate-200 px-3 py-3 focus:outline-none focus:ring-2 focus:ring-emerald-400" placeholder="Es. Maria"/>
            </div>
            <div>
              <label class="text-xs text-slate-600">Cognome</label>
              <input id="cognome" class="mt-1 w-full rounded-xl border border-slate-200 px-3 py-3 focus:outline-none focus:ring-2 focus:ring-emerald-400" placeholder="Es. Rossi"/>
            </div>
            <div class="md:col-span-2">
              <label class="text-xs text-slate-600">Cellulare</label>
              <input id="cellulare" class="mt-1 w-full rounded-xl border border-slate-200 px-3 py-3 focus:outline-none focus:ring-2 focus:ring-emerald-400" placeholder="Es. 3331234567"/>
            </div>
            <div class="md:col-span-2">
              <label class="text-xs text-slate-600">Seminarista di riferimento</label>
              <select id="seminarista" class="mt-1 w-full rounded-xl border border-slate-200 px-3 py-3 focus:outline-none focus:ring-2 focus:ring-emerald-400"></select>
            </div>
            <div id="seminaristaAltroWrap" class="hidden md:col-span-2">
              <label class="text-xs text-slate-600">Altro seminarista</label>
              <input id="seminarista_altro" class="mt-1 w-full rounded-xl border border-slate-200 px-3 py-3 focus:outline-none focus:ring-2 focus:ring-emerald-400" placeholder="Nome e cognome"/>
            </div>
          </div>
          <div class="mt-4 flex items-start gap-3">
            <input type="checkbox" id="consenso" class="mt-1 h-4 w-4"/>
            <label for="consenso" class="text-sm">Acconsento al trattamento dei dati per finalità organizzative della raccolta (GDPR).</label>
          </div>
          <div class="mt-5 flex items-center justify-between gap-3">
            <div class="text-xs text-slate-500">Stato: <span id="status">in attesa</span></div>
            <button id="submitBtn" class="btn btn-primary">Invia preordine</button>
          </div>
          <div id="result" class="text-sm mt-3 text-slate-700"></div>
        </div>
        <aside class="bg-white rounded-2xl card p-5">
          <h3 class="font-semibold">Riepilogo</h3>
          <div class="mt-2 text-sm text-slate-600 space-y-1">
            <div class="flex justify-between"><span>Birra</span><span id="sum-birra">0</span></div>
            <div class="flex justify-between"><span>Felpa</span><span id="sum-felpa">0</span></div>
            <div class="flex justify-between"><span>Cappello</span><span id="sum-cappello">0</span></div>
            <div class="flex justify-between"><span>Dolce</span><span id="sum-dolce">0</span></div>
            <hr class="my-2 border-slate-200"/>
            <div class="flex justify-between font-semibold"><span>Totale stimato</span><span id="totaleSide">€ 0,00</span></div>
          </div>
          <p class="mt-3 text-xs text-slate-500">È una stima: l’ordine verrà confermato con il tuo seminarista.</p>
        </aside>
      </div>
    </section>

    <!-- CAUSA -->
    <section id="causa" class="pb-16">
      <div class="rounded-2xl overflow-hidden mb-6 card">
        <div class="h-40 md:h-56 w-full bg-cover bg-center relative" id="causaBanner">
          <div class="absolute inset-0 bg-red-900/30 mix-blend-multiply"></div>
          <div class="absolute inset-0 flex items-center justify-center">
            <div class="text-center text-white">
              <div class="text-sm uppercase tracking-widest opacity-90">Insieme per la</div>
              <div class="text-2xl md:text-3xl font-extrabold">Terra Santa</div>
            </div>
          </div>
        </div>
      </div>
      <div class="bg-white rounded-2xl card p-6">
        <h2 class="text-xl font-bold">Perché questa raccolta?</h2>
        <p class="mt-2 text-slate-600">Come comunità del Seminario, in occasione di Avvento e Natale desideriamo sostenere progetti in Terra Santa. I fondi raccolti contribuiranno a iniziative caritative, educative e di assistenza. Grazie ai tuoi preordini possiamo pianificare al meglio gli acquisti, ridurre sprechi e massimizzare l'aiuto concreto.</p>
      </div>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="mt-10 bg-slate-900 text-slate-100">
    <div class="max-w-6xl mx-auto px-4 md:px-6 py-8 flex flex-col items-center space-y-2 text-center">
      <img id="logoFooter" alt="Logo Seminario" class="h-8 w-auto opacity-95"/>
      <div>Via Papa Pio XI, 32 - Venegono Inferiore (VA)</div>
      <div class="text-xs opacity-80">© <span id="yearNow"></span> GAMis - Seminario Arcivescovile di Milano</div>
    </div>
  </footer>

<script>
// ===== CONFIG =====
const ENDPOINT = "https://script.google.com/a/macros/seminario.milano.it/s/AKfycbyLq5FvkCvL50Eqc0ndTtHUSQuOKnOsKQK9wW5JgsnbzLQomnO4U6FpAUiUcWa-r2QNqw/exec"; 
const IMAGES = {
  hero:   "img/hero.jpg",
  birra:  "img/birra.jpg",
  felpa:  "img/felpa.jpg",
  cappello:"img/cappello.jpg",
  dolce:  "https://ibb.co/BVj3sPzJ",
  causa:  "https://ibb.co/h1FX5Lw5",
};
const SEMINARISTI = ["— Seleziona —","Abbate don Nikolas", "Angelini don Andrea", "Bassi Andrea", "Bergamini don Gioele", "Bianchi don Giuseppe", "Altro…"];
const LOGO_URL = "https://ibb.co/fYGVkwp2"; // Inserisci qui l'URL del logo

// CONFIG prodotti + prezzi
const OPTIONS = {
  birra:   { price: 10 },
  felpa:   { price: 25 },
  cappello:{ price: 12 },
  dolce:   { price: 10 }
};

// ===== STATO =====
const state = {
  birra:[], felpa:[], cappello:[], dolce:[],
  draft:{ birra:{qty:0}, felpa:{qty:0}, cappello:{qty:0}, dolce:{qty:0} }
};

// ===== UTILS =====
const eur = (n)=> (Number.isFinite(n)?n:0).toLocaleString('it-IT',{style:'currency',currency:'EUR'});
const qtySum = (arr)=> Array.isArray(arr)? arr.reduce((a,i)=> a + (parseFloat(i.qty)||0), 0) : 0;
const qtyAll = (k)=> qtySum(state[k]) + (parseFloat(state.draft[k]?.qty)||0);
const price = (k)=> parseFloat(OPTIONS[k]?.price)||0;
const total = ()=> ['birra','felpa','cappello','dolce'].reduce((s,k)=> s + qtyAll(k)*price(k), 0);

function refresh(){
  const t = total();
  document.getElementById('totaleTop').textContent='Totale stimato: '+eur(t);
  document.getElementById('totaleSide').textContent='Totale stimato: '+eur(t);
}

function setup(){
  // logo e anno
  document.getElementById('logoTop').src = LOGO_URL;
  document.getElementById('logoFooter').src = LOGO_URL;
  document.getElementById('yearNow').textContent = new Date().getFullYear();

  // immagini principali
  document.getElementById('heroBgSafe').style.backgroundImage = `url('${IMAGES.hero}')`;
  document.getElementById('causaBanner').style.backgroundImage = `url('${IMAGES.causa}')`;

  // immagini prodotti
  document.getElementById('img-birra').src   = IMAGES.birra;
  document.getElementById('img-felpa').src   = IMAGES.felpa;
  document.getElementById('img-cappello').src= IMAGES.cappello;
  document.getElementById('img-dolce').src   = IMAGES.dolce;

  refresh();
}

// avvio DOM pronto
if(document.readyState==='loading') document.addEventListener('DOMContentLoaded', setup); else setup();
</script>

</body>
</html>
