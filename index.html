<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GAMis Avvento 2025 - Raccolta fondi a sostegno della Terra Santa</title>
  <style>
    :root{ --bg:#ffffff; --text:#0b0b0b; --muted:#666; --accent:#000; --line:#e6e6e6; }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif}
    a{color:inherit;text-decoration:none}
    img{max-width:100%;display:block}
    .container{max-width:1200px;margin:0 auto;padding:0 16px}

    /* Header */
    header.site{position:sticky;top:0;z-index:50;background:rgba(255,255,255,.7);backdrop-filter:blur(10px);border-bottom:1px solid var(--line);padding:22px 0}
    .nav{display:flex;align-items:center;justify-content:space-between;padding:0 16px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:900;letter-spacing:.3px}
    .brand .logo-img{height:40px;object-fit:cover}
    .cause-ref{font-size:13px;color:#444;border:1px solid var(--line);padding:6px 10px;border-radius:999px;background:#fff}
    @media (max-width:720px){header.site{padding:22px 0}.nav{padding:0 20px}.brand .logo-img{width:auto;height:38px}}

    /* Hero */
    .hero{position:relative;min-height:75vh;display:grid;align-items:end;overflow:hidden}
    .hero-bg{position:absolute;inset:0;background:url('https://raw.githubusercontent.com/gamislavoro/gamisavvento/refs/heads/main/terrasanta1.jpg') center/cover no-repeat}
    .hero-overlay{position: absolute;inset: 0; background: linear-gradient(to bottom, rgba(0,0,0,0.75) 0%,rgba(0,0,0,0.55) 15%, rgba(0,0,0,0.25) 35%,rgba(0,0,0,0.05) 50%,transparent 65%);}
    .hero-inner{position:relative;padding:60px 0;text-align:left}
    h1{font-size:clamp(32px,5.5vw,56px);line-height:1.05;margin:0 0 10px 0}
    p.lead{color:#444;max-width:760px}
    .hero h1,
    .hero .lead{color: #fff;}


    /* Band */
    .band{position:relative;overflow:hidden;border-top:1px solid var(--line);border-bottom:1px solid var(--line);background:#f6f6f6}
    .band .track{display:flex;gap:28px;white-space:nowrap;animation:scroll 28s linear infinite;padding:10px 0}
    @keyframes scroll{from{transform:translateX(0)}to{transform:translateX(-50%)}}

    /* Causa */
    .cause-band{position:relative;color:#fff;padding:0}
    .cause-grid{display:grid;grid-template-columns:1fr 1fr;min-height:360px}
    .cause-media{background:url('https://raw.githubusercontent.com/gamislavoro/gamisavvento/refs/heads/main/causa.jpg') center/cover no-repeat}
    .cause-text{max-width:720px;margin:0;}
    
    /* Sections */
    section{padding:48px 0;border-top:1px solid var(--line)}
    h2{font-size:clamp(22px,4vw,36px);margin:0 0 6px 0}
    .overline{font-size:12px;letter-spacing:.18em;text-transform:uppercase;color:#888}

   /* Catalogo */
    .look{display:grid;gap:14px;grid-template-columns:repeat(2,1fr);} 
    .tile{position:relative;border:1px solid var(--line);border-radius:16px;overflow:hidden;background:#fff;transition:transform .2s ease, box-shadow .2s ease}
    .tile:hover{transform:translateY(-3px);box-shadow:0 10px 24px rgba(0,0,0,.06)}
    .tile img{aspect-ratio:3/2;object-fit:cover;height:auto;} 
    .tile .cap{position:absolute;inset:auto 10px 10px 10px;display:flex;justify-content:space-between;align-items:flex-end;color:#111}
    .cap h3{margin:0;font-weight:900;background:#fff;padding:6px 10px;border-radius:10px;font-size:14px;max-width:75%}
    .cap .price{background:#111;color:#fff;font-weight:800;padding:6px 10px;border-radius:999px;font-size:12px}
    .span-6{grid-column:span 6}.span-5{grid-column:span 5}.span-4{grid-column:span 4}.span-3{grid-column:span 3}.span-2{grid-column:span 2}

    /* Form */
    .grid-2{display:grid;gap:16px;grid-template-columns:repeat(2,minmax(0,1fr))}
    .form-grid{display:grid;gap:16px}
    .field label{display:block;font-size:13px;color:#666;margin-bottom:6px}
    .input,.select{width:100%;padding:12px 12px;border-radius:12px;border:1px solid var(--line);background:#fff;color:var(--text);outline:none;appearance:none;-webkit-appearance:none;-moz-appearance:none;line-height:1.2}
    .groupbox{border:1px solid var(--line);border-radius:12px;padding:12px;background:#fff;margin-bottom:16px}
    .group-grid{display:grid;gap:12px;grid-template-columns:repeat(2,minmax(0,1fr))}
    .remove{background:transparent;color:#861f2b;border:1px solid #f1c4cc;padding:10px 14px;border-radius:12px;cursor:pointer}
    .add-btn{background:#000;color:#fff;border:1px solid #000;padding:10px 14px;border-radius:14px;cursor:pointer;margin-top:8px}

    .summary{position:sticky;top:84px;border:1px solid var(--line);border-radius:18px;background:#fff;box-shadow:0 8px 24px rgba(0,0,0,.05)}
    .summary .content{padding:18px}
    .line{height:1px;background:var(--line);margin:8px 0}
    .alert{border:1px solid #2b9c63;background:#e9f8f1;color:#145a32;padding:12px 14px;border-radius:12px;font-size:14px}
    .alert.error{border-color:#d1525c;background:#ffeef0;color:#861f2b}

    footer{border-top:1px solid var(--line);padding:34px 0;color:#222;font-size:14px}
    .footer-brand{display:flex;flex-direction:column;gap:10px;align-items:center;text-align:center;margin:0 auto}
    .footer-logo{height:40px;object-fit:cover}
    
    @media (max-width:980px){
      .look{grid-template-columns:1fr}
      .span-5,.span-4,.span-3{grid-column:span 2}
      .grid-2{grid-template-columns:1fr}
      .summary{position:static}
      .hero-inner{text-align:center}
      .cause-grid{grid-template-columns:1fr !important}
      .cause-media{order:1; min-height:220px; height:220px}
      .cause-pane{order:2}
      .container{padding:0 24px}
      header.site .nav{padding:0 24px}
      .cause-text{width: 100%;max-width: 100%;}
      .cause-pane .container{padding: 0 24px;}
    }

    }
      .hero-inner{text-align:center}/* margini mobile piÃ¹ larghi */
      .container{padding:0 24px}
      header.site .nav{padding:0 24px}
      /* testo causa full width e senza overflow */
      .cause-text{max-width:100%; width:100%; padding:28px 20px}
    }
  </style>
</head>
<body>
  <header class="site">
    <div class="container nav">
      <a href="#home" class="brand">
        <img src="https://raw.githubusercontent.com/gamislavoro/gamisavvento/refs/heads/main/logo_gamis_sito.png" alt="Logo GAMis" class="logo-img" />
      </a>
      <a class="cause-ref" href="#cause">La causa</a>
    </div>
  </header>

  <section id="home" class="hero">
    <div class="hero-bg"></div>
    <div class="hero-overlay"></div>
    <div class="container hero-inner">
      <h1>Scegli, preordina, <span style="background:linear-gradient(90deg,#000,#555);-webkit-background-clip:text;background-clip:text;color:transparent">dona speranza</span></h1>
      <p class="lead">Raccolta fondi a sostegno della Terra Santa.</p>
    </div>
  </section>

  <div class="band" aria-hidden="true">
    <div class="track">
      <span> <b>PREORDINI APERTI</b> Â· BIRRA Â· FELPE Â· CAPPELLI Â· SOSTIENI LA TERRA SANTA</span>
      <span> <b>PREORDINI APERTI</b> Â· BIRRA Â· FELPE Â· CAPPELLI Â· SOSTIENI LA TERRA SANTA</span>
    </div>
  </div>

  <section id="cause" class="cause-band">
    <div class="cause-grid">
      <div class="cause-media"></div>
      <div class="cause-pane" style="background:#111;display:flex;align-items:center">
        <div class="container">
          <div class="cause-text">
            <div class="overline" style="color:#9ad;">La causa</div>
            <h2>PerchÃ© e per cosa raccogliamo</h2>
            <p>Per il Tempo di Avvento 2025 il GAMis ha scelto di sostenere un progetto del vicario di Gerusalemme Mons. William Shomali. La scelta Ã¨ motivata dalla conoscenza con Don Andrea Zolli, presbitero diocesano ambrosiano, il quale ha maturato tra gli anni di seminario e quelli di ministero una forte passione per la Terra Santa.</p>
            <p>Don Andrea nei suoi numerosi viaggi in Terra Santa si Ã¨ sempre piÃ¹ interessato non tanto allâ€™archeologia quanto alle comunitÃ  soprattutto cristiane che vivono nella Cisgiordania. Dopo essersi recato per due volte con il Seminario, Don Andrea Ã¨ stato in pellegrinaggio in Terra Santa prima da solo e poi con i giovani delle parrocchie dove ha svolto il suo ministero. Lâ€™intensitÃ  dellâ€™esperienza Ã¨ stata tale da chiedere, nel 2018 allâ€™Arcivescovo Mario Delpini di poter approfondire gli studi biblici.</p>
            <p>Don Andrea sostiene dallâ€™Italia 12 progetti per mezzo dei quali mantiene legami con le comunitÃ  della Cisgiordania. A suo dire, lâ€™aiuto finanziario e pratico Ã¨ il mezzo per creare una relazione che nel tempo rimane e fa sentire le comunitÃ  come accompagnate, non abbandonate anche nei tempi difficili della guerra.</p>
            <p>Anche noi avremo lâ€™occasione di metterci in contatto con le comunitÃ  che aiutiamo. Il progetto che abbiamo scelto di sostenere riguarda due ambiti: il contributo allâ€™affitto di 10 famiglie in difficoltÃ  e lâ€™acquisto di un endoscopio per i reparti di laparoscopia, ginecologia, urologia, otorinolaringoiatria e ortopedia per un ospedale locale.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section id="prodotti">
    <div class="container">
      <div class="overline">Catalogo</div>
      <h2>Prodotti in preordine</h2>
      <div class="look" style="margin-top:16px">
        <article class="tile"><img src="https://raw.githubusercontent.com/gamislavoro/gamisavvento/refs/heads/main/felpe.jpg" alt="Felpa Humilitas" /><div class="cap"><h3>Felpa "Humilitas"</h3><span class="price">â‚¬20</span></div></article>
        <article class="tile"><img src="https://raw.githubusercontent.com/gamislavoro/gamisavvento/refs/heads/main/cappello.jpg" alt="Cappello" /><div class="cap"><h3>Cappello invernale</h3><span class="price">â‚¬7</span></div></article>
        <article class="tile"><img src="https://raw.githubusercontent.com/gamislavoro/gamisavvento/refs/heads/main/combo.jpg" alt="Combo felpa+cappello" /><div class="cap"><h3>Combo "Felpa + Cappello"</h3><span class="price">â‚¬25</span></div></article>
        <article class="tile"><img src="https://raw.githubusercontent.com/gamislavoro/gamisavvento/refs/heads/main/birra.jpg" alt="Birra artigianale" /><div class="cap"><h3>Birra artigianale</h3><span class="price">â‚¬15</span></div></article>
      </div>
    </div>
  </section>

  <section id="preordina">
    <div class="container">
      <div class="overline">Prenota ora</div>
      <h2>Compila il tuo preordine</h2>
      <p style="color:#444">Nessun pagamento online: ti contatteremo per la consegna e il ritiro.</p>

      <div class="grid-2" style="margin-top:16px;align-items:start">
        <div>
          <form id="order-form" class="form-grid">
            <div class="grid-2">
              <div class="field"><label>Nome</label><input required class="input" id="nome" placeholder="Mario" /></div>
              <div class="field"><label>Cognome</label><input required class="input" id="cognome" placeholder="Rossi" /></div>
              <div class="field"><label>Cellulare</label><input required class="input" id="cellulare" placeholder="333 1234567" /></div>
              <div class="field">
                <label>Seminarista di riferimento</label>
                <input list="seminaristi" class="input" id="seminarista" placeholder="Cerca o scegli..." />
                <datalist id="seminaristi"></datalist>
                <div id="seminarista-altro-wrap" style="display:none;margin-top:8px"><input class="input" id="seminarista-altro" placeholder="Inserisci nome e cognome" /></div>
              </div>
            </div>

            <div>
              <div style="display:flex;justify-content:space-between;align-items:center;margin:10px 0"><b>Birra (confezione da 3)</b><span style="color:#666">â‚¬15</span></div>
              <div id="beer-list" class="form-grid"></div>
              <button type="button" class="add-btn" onclick="addVariant('beer')">+ Aggiungi confezione</button>
            </div>

            <div>
              <div style="display:flex;justify-content:space-between;align-items:center;margin:10px 0"><b>Felpa "Humilitas"</b><span style="color:#666">â‚¬20</span></div>
              <div id="hoodie-list" class="form-grid"></div>
              <button type="button" class="add-btn" onclick="addVariant('hoodie')">+ Aggiungi felpa</button>
            </div>

            <div>
              <div style="display:flex;justify-content:space-between;align-items:center;margin:10px 0"><b>Cappello in lana</b><span style="color:#666">â‚¬7</span></div>
              <div id="beanie-list" class="form-grid"></div>
              <button type="button" class="add-btn" onclick="addVariant('beanie')">+ Aggiungi cappello</button>
            </div>

            <div>
              <div style="display:flex;justify-content:space-between;align-items:center;margin:10px 0"><b>Combo felpa + cappello</b><span style="color:#666">â‚¬25</span></div>
              <div id="combo-list" class="form-grid"></div>
              <button type="button" class="add-btn" onclick="addVariant('combo')">+ Aggiungi combo</button>
            </div>

            <div class="field">
              <label style="display:flex;gap:10px;align-items:center">
                <input type="checkbox" id="gdpr" required />
                <span>Acconsento al trattamento dei dati per finalitÃ  organizzative della raccolta (GDPR).</span>
              </label>
            </div>
          </form>
        </div>

        <aside class="summary"><div class="content">
          <h3 style="margin:0 0 10px 0">Riepilogo</h3>
          <div id="summary-items" style="color:#666">Nessun prodotto selezionato.</div>
          <div class="line"></div>
          <div style="display:flex;justify-content:space-between;font-weight:800"><span>Totale stimato</span><span id="summary-total">â‚¬0,00</span></div>
          <button class="add-btn" id="submit-btn" style="width:100%;margin-top:12px">Invia preordine</button>
          <div id="form-result" class="alert" style="display:none;margin-top:10px"></div>
        </div></aside>
      </div>
    </div>
  </section>

  <footer>
    <div class="container">
      <div class="footer-brand">
        <img src="https://raw.githubusercontent.com/gamislavoro/gamisavvento/refs/heads/main/logo_gamis_sito.png" alt="Logo GAMis" class="footer-logo">
        <div>Via Papa Pio XI, 32 â€“ Venegono Inferiore (VA)</div>
        <div style="color:#666">Â© <span id="year"></span> GAMis â€“ Seminario Arcivescovile di Milano</div>
      </div>
    </div>
  </footer>

  <script>
  (function(){
    // === Google Forms endpoint + entries (TUO FORM) ===
    const GOOGLE_FORM_ACTION = "https://docs.google.com/forms/d/e/1FAIpQLSexV3DiQfv_zdQr7fwE3zc3HPIuQbWn3fXnYe_-cWHw3TLdYA/formResponse";
    const FORM_ENTRIES = {
      nome:        "entry.573768494",
      cognome:     "entry.591311676",
      cellulare:   "entry.1127229748",
      seminarista: "entry.1838550629",
      Birra:       "entry.553587816",
      Felpa:       "entry.208610142",
      Cappello:    "entry.1280512464",
      Combo:       "entry.266426261",
      Totale:      "entry.671938690"
    };

    // === Prezzi e dati ===
    const PRICES = { beerPack: 15, hoodie: 20, beanie: 7, combo: 25 };
    const SEMINARISTI = ["Abbate don Nikolas", "Angelini don Andrea", "Bassi Andrea", "Bergamini don Gioele", "Bestetti Simone", "Bianchi don Giuseppe", "Bisi Federico", "BolaÃ±os JosÃ¨", "BrancÃ¨ don Samuele", "Caholo Gilberto F. C.", "Capizzi Emanuele", "Cardani Lorenzo", "Carchedi Davide", "Combi Fabio", "Conti Giacomo", "Corti Giovanni", "Crivellari Matteo", "Erroi Filippo", "Ferrera Pietro", "Frattolillo don NicolÃ²", "Freddi Giacomo", "Garzone B. Alessandro", "Gazzoli Daniele", "Giovenzana Francesco", "Girelli Simone", "Gorno Riccardo", "Guido don Emanuele", "Landini Marco", "Lattuada Stefano", "MaccÃ  don Paolo", "Macchi don Paolo", "Magistrelli don Stefano", "Mani Mbala Simon Pierre", "Marchiori Manuel", "Mariani Massimiliano", "Martinelli Samuele", "Meda Francesco", "Mesiano Lorenzo", "Molteni don Lorenzo", "Nossa Alessandro", "Orfano Michele", "Pagani Carlo", "Palazzo Andrea", "Pandolfi Andrea", "Parini Giovanni", "Pasquot Filippo", "Perego Gianluca", "Rossi Alessandro", "Santambrogio Tommaso", "Sinigaglia Francesco", "Swich don Andrea", "Tamburrino Stefano", "Tchingui Moises K.", "Valli Giovanni", "Vicini Alessio", "Zannini Alessandro", "Zappaterra Matteo", "Altro..."];
    const hoodieModels = { offwhite: ["Arancio","Verdone","Nero"], nero: ["Rosa shocking","Bianco","Celeste"] };
    const hoodieSizes  = ["S","M","L","XL","2XL"];

    // === Utils ===
    const euro = n => new Intl.NumberFormat('it-IT',{style:'currency',currency:'EUR'}).format(n||0);
    const labelModel = id => id==='offwhite' ? 'Offwhite' : (id==='nero' ? 'Nero' : id);
    const cap = s => s? s.charAt(0).toUpperCase()+s.slice(1) : s;

    // === Footer year ===
    const y = document.getElementById('year'); if(y) y.textContent = new Date().getFullYear();

    // === Seminaristi datalist ===
    const datalist = document.getElementById('seminaristi');
    const seminaristaInput = document.getElementById('seminarista');
    const seminaristaAltroWrap = document.getElementById('seminarista-altro-wrap');
    const seminaristaAltro = document.getElementById('seminarista-altro');
    function refreshDatalist(){ if(!datalist) return; datalist.innerHTML=''; SEMINARISTI.forEach(n=>{ const o=document.createElement('option'); o.value=n; datalist.appendChild(o); }); const alt=document.createElement('option'); alt.value='Altro...'; datalist.appendChild(alt); }
    refreshDatalist();
    if (seminaristaInput) seminaristaInput.addEventListener('input', ()=>{ if(seminaristaInput.value.trim().toLowerCase()==='altro...'){ seminaristaAltroWrap.style.display='block'; seminaristaAltro && seminaristaAltro.focus(); } else seminaristaAltroWrap.style.display='none'; });

    // === Stato ===
    const state = { beer:[], hoodie:[], beanie:[], combo:[] };

    // === Aggiunta/rimozione varianti ===
    function addVariant(type){
      if(type==='beer') state.beer.push({ qty:1 });
      if(type==='hoodie') state.hoodie.push({ model:'offwhite', print:'Arancio', size:'M', qty:1 });
      if(type==='beanie') state.beanie.push({ color:'blu', qty:1 });
      if(type==='combo') state.combo.push({ model:'offwhite', print:'Arancio', size:'M', color:'blu', qty:1 });
      renderVariants(type); renderSummary();
    }
    function removeVariant(type, idx){ state[type].splice(idx,1); renderVariants(type); renderSummary(); }
    window.addVariant = addVariant; window.removeVariant = removeVariant; // per gli onclick inline

    function renderVariants(type){
      const host = document.getElementById({beer:'beer-list',hoodie:'hoodie-list',beanie:'beanie-list',combo:'combo-list'}[type]);
      if(!host) return; host.innerHTML='';
      state[type].forEach((v,idx)=>{
        const row=document.createElement('div'); row.className='groupbox';
        if(type==='beer') row.innerHTML = `
          <div class="group-grid">
            <div class="field"><label>QuantitÃ  confezioni</label><input class="input qty" type="number" min="1" value="${v.qty}"></div>
            <div class="field" style="grid-column:1/-1"><button type="button" class="remove" onclick="removeVariant('beer',${idx})">ðŸ—‘ Rimuovi</button></div>
          </div>`;
        if(type==='hoodie') row.innerHTML = `
          <div class="group-grid">
            <div class="field"><label>Modello</label>
              <select class="select model">
                <option value="offwhite" ${v.model==='offwhite'?'selected':''}>Offwhite</option>
                <option value="nero" ${v.model==='nero'?'selected':''}>Nero</option>
              </select>
            </div>
            <div class="field"><label>Stampa</label><select class="select print"></select></div>
            <div class="field"><label>Taglia</label>
              <select class="select size">${hoodieSizes.map(s=>`<option value="${s}" ${v.size===s?'selected':''}>${s}</option>`).join('')}</select>
            </div>
            <div class="field"><label>QuantitÃ </label><input class="input qty" type="number" min="1" value="${v.qty}"></div>
            <div class="field" style="grid-column:1/-1"><button type="button" class="remove" onclick="removeVariant('hoodie',${idx})">ðŸ—‘ Rimuovi</button></div>
          </div>`;
        if(type==='beanie') row.innerHTML = `
          <div class="group-grid">
            <div class="field"><label>Colore</label>
              <select class="select color">
                <option value="blu" ${v.color==='blu'?'selected':''}>Blu</option>
                <option value="nero" ${v.color==='nero'?'selected':''}>Nero</option>
                <option value="grigio" ${v.color==='grigio'?'selected':''}>Grigio</option>
              </select>
            </div>
            <div class="field"><label>QuantitÃ </label><input class="input qty" type="number" min="1" value="${v.qty}"></div>
            <div class="field" style="grid-column:1/-1"><button type="button" class="remove" onclick="removeVariant('beanie',${idx})">ðŸ—‘ Rimuovi</button></div>
          </div>`;
        if(type==='combo') row.innerHTML = `
          <div class="group-grid">
            <div class="field"><label>Felpa â€“ Modello</label>
              <select class="select model">
                <option value="offwhite" ${v.model==='offwhite'?'selected':''}>Offwhite</option>
                <option value="nero" ${v.model==='nero'?'selected':''}>Nero</option>
              </select>
            </div>
            <div class="field"><label>Felpa â€“ Stampa</label><select class="select print"></select></div>
            <div class="field"><label>Felpa â€“ Taglia</label>
              <select class="select size">${hoodieSizes.map(s=>`<option value="${s}" ${v.size===s?'selected':''}>${s}</option>`).join('')}</select>
            </div>
            <div class="field"><label>Cappello â€“ Colore</label>
              <select class="select color">
                <option value="blu" ${v.color==='blu'?'selected':''}>Blu</option>
                <option value="nero" ${v.color==='nero'?'selected':''}>Nero</option>
                <option value="grigio" ${v.color==='grigio'?'selected':''}>Grigio</option>
              </select>
            </div>
            <div class="field"><label>QuantitÃ </label><input class="input qty" type="number" min="1" value="${v.qty}"></div>
            <div class="field" style="grid-column:1/-1"><button type="button" class="remove" onclick="removeVariant('combo',${idx})">ðŸ—‘ Rimuovi</button></div>
          </div>`;
        host.appendChild(row);

        // Bind
        if(type==='beer'){
          row.querySelector('.qty').addEventListener('input',e=>{ v.qty=parseInt(e.target.value||'1'); renderSummary(); });
        }
        if(type==='hoodie'){
          const modelSel=row.querySelector('.model');
          const printSel=row.querySelector('.print');
          const sizeSel=row.querySelector('.size');
          function fillPrints(){ printSel.innerHTML=''; (hoodieModels[v.model]||[]).forEach(p=>{ const o=document.createElement('option'); o.value=p; o.textContent=p; printSel.appendChild(o); }); printSel.value = v.print || printSel.options[0].value; v.print = printSel.value; }
          fillPrints();
          modelSel.addEventListener('change',e=>{ v.model=e.target.value; fillPrints(); renderSummary(); });
          printSel.addEventListener('change',e=>{ v.print=e.target.value; renderSummary(); });
          sizeSel.addEventListener('change',e=>{ v.size=e.target.value; renderSummary(); });
          row.querySelector('.qty').addEventListener('input',e=>{ v.qty=parseInt(e.target.value||'1'); renderSummary(); });
        }
        if(type==='beanie'){
          row.querySelector('.color').addEventListener('change',e=>{ v.color=e.target.value; renderSummary(); });
          row.querySelector('.qty').addEventListener('input',e=>{ v.qty=parseInt(e.target.value||'1'); renderSummary(); });
        }
        if(type==='combo'){
          const modelSel=row.querySelector('.model');
          const printSel=row.querySelector('.print');
          const sizeSel=row.querySelector('.size');
          const colorSel=row.querySelector('.color');
          function fillPrints(){ printSel.innerHTML=''; (hoodieModels[v.model]||[]).forEach(p=>{ const o=document.createElement('option'); o.value=p; o.textContent=p; printSel.appendChild(o); }); printSel.value = v.print || printSel.options[0].value; v.print = printSel.value; }
          fillPrints();
          modelSel.addEventListener('change',e=>{ v.model=e.target.value; fillPrints(); renderSummary(); });
          printSel.addEventListener('change',e=>{ v.print=e.target.value; renderSummary(); });
          sizeSel.addEventListener('change',e=>{ v.size=e.target.value; renderSummary(); });
          colorSel.addEventListener('change',e=>{ v.color=e.target.value; renderSummary(); });
          row.querySelector('.qty').addEventListener('input',e=>{ v.qty=parseInt(e.target.value||'1'); renderSummary(); });
        }
      });
    }

    function productRows(){
      const rows=[];
      state.beer.forEach(b=>{ if((b.qty||0)>0) rows.push({prodotto:'Birra', valore:`Confezione da 3 (x${b.qty})`, prezzo:PRICES.beerPack*b.qty}); });
      state.hoodie.forEach(h=>{ if((h.qty||0)>0) rows.push({prodotto:'Felpa', valore:`${labelModel(h.model)} \"${h.print} â€“ Taglia ${h.size}\" (${h.qty})`, prezzo:PRICES.hoodie*h.qty}); });
      state.beanie.forEach(c=>{ if((c.qty||0)>0) rows.push({prodotto:'Cappello', valore:`${cap(c.color)} (${c.qty})`, prezzo:PRICES.beanie*c.qty}); });
      state.combo.forEach(x=>{ if((x.qty||0)>0) rows.push({prodotto:'Combo', valore:`${labelModel(x.model)} \"${x.print} â€“ Taglia ${x.size}\" + ${cap(x.color)} (${x.qty})`, prezzo:PRICES.combo*x.qty}); });
      return rows;
    }
    function calcTotal(){ return productRows().reduce((s,r)=>s+r.prezzo,0); }
    function renderSummary(){
      const box=document.getElementById('summary-items');
      const rows=productRows();
      if(!box) return;
      if(rows.length===0){ box.textContent='Nessun prodotto selezionato.'; }
      else{
        box.innerHTML='';
        rows.forEach(r=>{
          const line=document.createElement('div');
          line.style.display='flex';
          line.style.justifyContent='space-between';
          line.style.gap='12px';
          line.innerHTML=`<span>${r.prodotto}</span><span style="color:#666">${r.valore}</span>`;
          box.appendChild(line);
        });
      }
      const totEl=document.getElementById('summary-total'); if(totEl) totEl.textContent=euro(calcTotal());
    }
    renderSummary();

    // === INVIO al Google Form ===
    const form = document.getElementById('order-form');
    const submitBtn = document.getElementById('submit-btn');
    const resultBox = document.getElementById('form-result');
    submitBtn && submitBtn.addEventListener('click', ()=> form && form.requestSubmit());

    form && form.addEventListener('submit', (e)=>{
      e.preventDefault(); if(resultBox) resultBox.style.display='none';
      const nome = document.getElementById('nome').value.trim();
      const cognome = document.getElementById('cognome').value.trim();
      const cellulare = document.getElementById('cellulare').value.trim();
      let seminaristaSel = document.getElementById('seminarista').value.trim();
      if(seminaristaSel.toLowerCase()==='altro...' || seminaristaSel==='') seminaristaSel = (document.getElementById('seminarista-altro').value||'').trim();
      if(!nome || !cognome || !cellulare || !seminaristaSel) return showMsg('Compila tutti i dati del cliente.', true);
      if(!document.getElementById('gdpr').checked) return showMsg('Per procedere Ã¨ necessario il consenso GDPR.', true);

      const join = arr => arr.filter(Boolean).join(' ; ');
      const birraTot = (state.beer||[]).reduce((s,v)=> s + (parseInt(v.qty||0)||0), 0);
      const cellBirra = birraTot>0 ? `Confezione da 3 (x${birraTot})` : '';
      const cellFelpa = join((state.hoodie||[]).filter(h=> (h.qty||0)>0).map(h=> `${labelModel(h.model)} "${h.print} â€“ Taglia ${h.size}" (${h.qty})`));
      const cellCappello = join((state.beanie||[]).filter(c=> (c.qty||0)>0).map(c=> `${cap(c.color)} (${c.qty})`));
      const cellCombo = join((state.combo||[]).filter(x=> (x.qty||0)>0).map(x=> `${labelModel(x.model)} "${x.print} â€“ Taglia ${x.size}" + ${cap(x.color)} (${x.qty})`));
      if(!cellBirra && !cellFelpa && !cellCappello && !cellCombo) return showMsg('Aggiungi almeno un prodotto.', true);
      const totale = euro(calcTotal());

      let proxy = document.getElementById('gform-proxy');
      if(!proxy){ proxy = document.createElement('form'); proxy.id='gform-proxy'; proxy.style.display='none'; document.body.appendChild(proxy); }
      proxy.method = 'POST'; proxy.action = GOOGLE_FORM_ACTION; proxy.target = 'gform-target'; proxy.innerHTML = '';
      const hid = (name, value) => { const i=document.createElement('input'); i.type='hidden'; i.name=name; i.value=value||''; proxy.appendChild(i); };
      hid(FORM_ENTRIES.nome,        nome);
      hid(FORM_ENTRIES.cognome,     cognome);
      hid(FORM_ENTRIES.cellulare,   cellulare);
      hid(FORM_ENTRIES.seminarista, seminaristaSel);
      hid(FORM_ENTRIES.Birra,       cellBirra);
      hid(FORM_ENTRIES.Felpa,       cellFelpa);
      hid(FORM_ENTRIES.Cappello,    cellCappello);
      hid(FORM_ENTRIES.Combo,       cellCombo);
      hid(FORM_ENTRIES.Totale,      totale);

      submitBtn.disabled=true; submitBtn.textContent='Invio in corso...';
      const iframe = document.getElementById('gform-target') || (()=>{ const f=document.createElement('iframe'); f.name='gform-target'; f.id='gform-target'; f.style.display='none'; document.body.appendChild(f); return f; })();
      const onDone = ()=>{ showMsg('Ordine registrato! Grazie!'); form.reset(); ['beer','hoodie','beanie','combo'].forEach(t=>state[t]=[]); renderSummary(); submitBtn.disabled=false; submitBtn.textContent='Invia preordine'; iframe.removeEventListener('load', onDone); };
      iframe.addEventListener('load', onDone, { once:true });
      proxy.submit();
    });

    function showMsg(txt, error=false){ if(!resultBox) return; resultBox.className='alert'+(error?' error':''); resultBox.textContent=txt; resultBox.style.display='block'; }

    // Piccolo catcher errori per vedere subito se qualcosa rompe
    window.addEventListener('error', (e)=>{ const box=document.getElementById('form-result'); if(!box) return; box.className='alert error'; box.style.display='block'; box.textContent='Errore JS: '+ e.message; });
  })();
  </script>

  <!-- Invisibile: form/iframe per Google Forms -->
  <form id="gform-proxy" action="#" style="display:none"></form>
  <iframe name="gform-target" id="gform-target" style="display:none"></iframe>
</body>
</html>
